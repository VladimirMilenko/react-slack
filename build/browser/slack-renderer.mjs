import"react";import t from"lodash";import e from"react-reconciler";import n from"uuid/v4";var i={SlackContainer:function(e,n,i,o){var r=this;this.unsubscribeFromAction=function(t){r.stateful&&r.subClient.unsubscribe(t)},this.subscribeToNewActionId=function(t){r.stateful&&r.subClient.subscribe(t)},this.appendChild=function(t){r.blocks.push(t),setImmediate(r.onCommited,0)},this.removeChild=function(t){var e=r.blocks.indexOf(t);r.blocks.splice(e,1),setImmediate(r.onCommited,0)},this.insertBefore=function(t,e){var n=r.blocks.indexOf(e);r.blocks.splice(n,0,t),setImmediate(r.onCommited,0)},this.onCommited=function(){var e=r.render();t.isEqual(r.lastCommited,e)||(r.stateful&&r.emitter.emit("commit",e),r.lastCommited=e)},this.render=function(){return r.blocks.map(function(t){return t.render()})},this.handlerRegistry=n,this.subClient=e,this.stateful=o,this.blocks=[],this.stateful&&(this.emitter=new EventEmitter,this.response_url=i,this.subClient.on("message",function(t,e){if(r.handlerRegistry[t]){var n=JSON.parse(e);r.response_url=n.response_url,r.handlerRegistry[t](n)}}),this.lastCommited=null)}},o=function(t,e,n){this.props=t,this.__root=e,this.__type=n};o.prototype.onCommit=function(){this.__root.onCommited()};var r=function(t){function e(e,n){t.call(this,e,n,"ACTIONS"),this.elements=[]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.appendChild=function(t){this.elements.push(t)},e.prototype.removeChild=function(t){var e=this.elements.indexOf(t);this.elements.splice(e,1)},e.prototype.insertBefore=function(t,e){var n=this.elements.indexOf(e);0===n?this.elements.unshift(t):this.elements.splice(n-1,0,t)},e.prototype.render=function(){return{type:"actions",elements:this.elements.map(function(t){return t.render()})}},e}(o),c=function(t){function e(e,n){t.call(this,null,n,"TEXT"),this.text=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.setText=function(t){this.text=t},e.prototype.render=function(){return{type:"plain_text",text:this.text}},e}(o),s=function(t){function e(e,n){t.call(this,e,n,"BUTTON"),this.children=[],this.onClick=e.onClick}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.appendChild=function(t){"TEXT"===t.__type&&this.children.push(t)},e.prototype.removeChild=function(t){var e=this.children.indexOf(t);this.children.splice(e,1)},e.prototype.insertBefore=function(t,e){var n=this.children.indexOf(e);0===n?this.children.unshift(t):this.children.splice(n-1,0,t)},e.prototype.render=function(){var t=this.style,e=this.value,n=this.confirm;return{type:"button",text:new c(this.children.map(function(t){return t.text}).join("")).render(),action_id:this.__actionId,value:e,style:t,confirm:n}},e}(o),l=function(t){function e(e,n){t.call(this,e,n,"MARKDOWN"),this.children=[]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.appendChild=function(t){this.children.push(t)},e.prototype.removeChild=function(t){var e=this.children.indexOf(t);this.children.splice(e,1)},e.prototype.insertBefore=function(t,e){var n=this.children.indexOf(e);0===n?this.children.unshift(t):this.children.splice(n-1,0,t)},e.prototype.render=function(){return{type:"mrkdwn",text:this.children.map(function(t){return t.text}).join("")}},e}(o),u=function(t){function e(e,n){t.call(this,e,n,"CONTEXT"),this.elements=[]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.appendChild=function(t){this.elements.push(t)},e.prototype.removeChild=function(t){var e=this.elements.indexOf(t);this.elements.splice(e,1)},e.prototype.insertBefore=function(t,e){var n=this.elements.indexOf(e);0===n?this.elements.unshift(t):this.elements.splice(n-1,0,t)},e.prototype.render=function(){return{type:"context",elements:this.elements.map(function(t){return t instanceof l?t.render():"TEXT"===t.__type?new c(t.text).render():void 0})}},e}(o),h=function(t){function e(e,n){t.call(this,e,n,"DATEPICKER"),this.onChange=null,this.value=e.value||void 0,this.placeholder=e.placeholder,this.initialDate=e.initialDate||void 0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.render=function(){var t=this.value,e=this.initialDate;return{type:"datepicker",placeholder:this.placeholder?new c(this.placeholder).render():void 0,action_id:this.__actionId,initial_date:t||e||void 0}},e}(o),d=function(t){function e(e,n){t.call(this,e,n,"DIVIDER"),this.children=[]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.appendChild=function(t){},e.prototype.removeChild=function(t){},e.prototype.render=function(){return{type:"divider"}},e}(o),p=function(t){function e(e,n){t.call(this,e,n,"SECTION"),this.fields=null,this.accessory=null,this.text=null}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.appendChild=function(t){switch(t.__type){case"SECTION_TEXT":this.text=t;break;case"SECTION_FIELDS":this.fields=t;break;case"SECTION_ACCESSORY":this.accessory=t;break;default:this.fields.push(t)}},e.prototype.removeChild=function(t){switch(t.__type){case"SECTION_TEXT":this.text=null;break;case"SECTION_FIELDS":this.fields=null;break;case"SECTION_ACCESSORY":this.accessory=null;break;default:var e=this.children.indexOf(t);this.fields.splice(e,1)}},e.prototype.insertBefore=function(t,e){this.appendChild(t)},e.prototype.render=function(){return{type:"section",text:this.text?this.text.render():void 0,fields:this.fields?this.fields.render():void 0,accessory:this.accessory?this.accessory.render():void 0}},e}(o),a=function(t){function e(e,n){var i=this;t.call(this,e,n,"SECTION_TEXT"),this.render=function(){return{type:i.children.some(function(t){return"MARKDOWN"===t.__type})?"mrkdwn":"plain_text",text:i.children.map(function(t){return t.render()}).map(function(t){return t.text}).join("")}},this.children=[]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.appendChild=function(t){this.children.push(t)},e.prototype.removeChild=function(t){var e=this.children.indexOf(t);this.children.splice(e,1)},e.prototype.insertBefore=function(t,e){var n=this.children.indexOf(e);0===n?this.children.unshift(t):this.children.splice(n-1,0,t)},e}(o),f=function(t){function e(e,n){var i=this;t.call(this,e,n,"SECTION_FIELDS"),this.render=function(){return i.children.map(function(t){return t.render()})},this.children=[]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.appendChild=function(t){this.children.push(t)},e.prototype.removeChild=function(t){var e=this.children.indexOf(t);this.children.splice(e,1)},e.prototype.insertBefore=function(t,e){var n=this.children.indexOf(e);0===n?this.children.unshift(t):this.children.splice(n-1,0,t)},e}(o),_=function(t){function e(e,n){var i=this;t.call(this,e,n,"SECTION_ACCESSORY"),this.render=function(){if(i.children.length>1)throw new Error("Accessory only accepts one child");return i.children&&0!==i.children.length?i.children[0].render():null},this.children=[]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.appendChild=function(t){this.children.push(t)},e.prototype.removeChild=function(t){var e=this.children.indexOf(t);this.children.splice(e,1)},e.prototype.insertBefore=function(t,e){var n=this.children.indexOf(e);0===n?this.children.unshift(t):this.children.splice(n-1,0,t)},e}(o),m=e({getRootHostContext:function(t){return{root:t}},getChildHostContext:function(t,e,n){return{}},getPublicInstance:function(t){return{}},prepareForCommit:function(t){},resetAfterCommit:function(t){},createInstance:function(t,e,n,i,o){return function(t,e,n){return{BUTTON:function(){return new s(e,n)},ACTIONS:function(){return new r(e,n)},CONTEXT:function(){return new u(e,n)},MARKDOWN:function(){return new l(e,n)},DIVIDER:function(){return new d(e,n)},SECTION:function(){return new p(e,n)},SECTION_TEXT:function(){return new a(e,n)},SECTION_FIELDS:function(){return new f(e,n)},SECTION_ACCESSORY:function(){return new _(e,n)},DATEPICKER:function(){return new h(e,n)}}[t]()}(t,e,n)},createTextInstance:function(t,e,n,i){return new c(t,e)},appendInitialChild:function(t,e){t.appendChild(e)},finalizeInitialChildren:function(t,e,i,o,r){switch(e){case"BUTTON":return void(i.onClick&&(t.__root&&t.__root.handlerRegistry&&t.__actionId&&(delete t.__root.handlerRegistry[t.__actionId],t.__root.unsubscribeFromAction(t.__actionId)),t.__actionId=n(),t.onClick=i.onClick,t.__root.handlerRegistry[t.__actionId]=t.onClick,t.__root&&t.__root.subscribeToNewActionId(t.__actionId)));case"DATEPICKER":return void(i.onChange&&(t.__root&&t.__root.handlerRegistry&&t.__actionId&&(delete t.__root.handlerRegistry[t.__actionId],t.__root.unsubscribeFromAction(t.__actionId)),t.__actionId=n(),t.onChange=i.onChange,t.__root.handlerRegistry[t.__actionId]=t.onChange,t.__root&&t.__root.subscribeToNewActionId(t.__actionId)));default:return}return!1},prepareUpdate:function(t,e,n,i,o,r){for(var c,s=[],l=0,u=new Set(Object.keys(i).concat(Object.keys(n))).values();l<u.length;l+=1){var h=u[l];"children"!==h&&n[h]!==i[h]&&s.push(((c={})[h]=i[h],c))}return s},shouldSetTextContent:function(t,e){return!1},shouldDeprioritizeSubtree:function(t,e){console.log("shouldDeprioritizeSubtree")},now:Date.now,isPrimaryRenderer:!0,scheduleDeferredCallback:"",cancelDeferredCallback:"",supportsMutation:!0,commitMount:function(t,e,n,i){},commitUpdate:function(t,e,i,o,r,c){switch(i){case"BUTTON":e.forEach(function(e){Object.keys(e).forEach(function(i){"onClick"===i?(t.__root&&t.__root.handlerRegistry&&(delete t.__root.handlerRegistry[t.__actionId],t.__root.unsubscribeFromAction(t.__actionId)),t.__actionId=n(),t.onClick=e[i],t.__root.handlerRegistry[t.__actionId]=t.onClick,t.__root&&t.__root.subscribeToNewActionId(t.__actionId)):t[i]=e[i]})});break;case"DATEPICKER":e.forEach(function(e){Object.keys(e).forEach(function(i){"onChange"===i?(t.__root&&t.__root.handlerRegistry&&(delete t.__root.handlerRegistry[t.__actionId],t.__root.unsubscribeFromAction(t.__actionId)),t.__actionId=n(),t.onChange=e[i],t.__root.handlerRegistry[t.__actionId]=t.onChange,t.__root&&t.__root.subscribeToNewActionId(t.__actionId)):t[i]=e[i]})});break;default:e.forEach(function(e){t[key]=e[key]})}setImmediate(function(){t.onCommit()},0)},resetTextContent:function(t){throw new Error("Not implemented")},commitTextUpdate:function(t,e,n){t.setText(n),setImmediate(function(){t.onCommit()},0)},appendChild:function(t,e){t.appendChild(e)},appendChildToContainer:function(t,e){t.appendChild(e)},insertBefore:function(t,e,n){},insertInContainerBefore:function(t,e,n){t.insertBefore(e,n)},removeChild:function(t,e){t.removeChild(e)},removeChildFromContainer:function(t,e){t.removeChild(e)}}),C={render:function(t,e){var n=m.createContainer(e,!1,!1);return m.updateContainer(t,n,null,null),e}},y={default:C};export default function(){return{components:y,container:i,SlackDom:C}}
//# sourceMappingURL=slack-renderer.mjs.map
